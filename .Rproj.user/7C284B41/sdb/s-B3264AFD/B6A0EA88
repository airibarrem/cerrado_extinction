{
    "contents" : "# RASTER NORMALIZATION\n#\n# Created: Nov. 2014\n# Author: Alvaro Iribarrem (IIS-Rio)\n#\n#\n#rm(list=ls())\n\n\nrast.norm = function(bandref=c(1),filepath=getwd()){\n#filepath=\"~/IIS_PROJECTS/Moore/Zonation_AF/in/\"\n  setwd(filepath)\n  require(raster)\n  start = Sys.time()\n  #\n  tif_files = dir(path=\"./in/\",pattern=\"*.tif\")\n  tif_files = sub(\".aux\",\"\",tif_files)\n  tif_files = sub(\".xml\",\"\",tif_files)\n  tif_files = sub(\"norm_\",\"\",tif_files)\n  tif_files = unique(tif_files)\n  nfiles = length(tif_files)\n  nbands = length(bandref)\n  #\n  scenes.norm = matrix(replicate(nbands*nfiles,raster()), nrow = nfiles, ncol = nbands)\n  proj = projection(raster(paste0(\"./in/\",tif_files[1]),band=bandref[1]))\n  #\n  for (i in 1:nbands){\n    #scenes.raw = lapply(tif_files, band=i, raster)\n    #ns = length(scenes.raw)\n    #eltime = Sys.time() - start\n    #cat(format(eltime), \"Band\", i, \"-\", ns, \"raw scenes read.\\n\")\n    for (j in 1:nfiles){\n      #values(scenes.raw[[j]]) = values(scenes.raw[[j]]) / max(values(scenes.raw[[j]]))\n      #values(scenes.raw[[j]]) = log(1+values(scenes.raw[[j]]))\n      scenes.norm[[j,i]] = raster(paste0(\"./in/\",tif_files[j]),band=bandref[i])\n      crs(scenes.norm[[j,i]]) = proj\n      eltime = Sys.time() - start\n      cat(format(eltime), \"Band\", bandref[i], \"- scene\", j, \"read.\\n\")\n      #eltime = Sys.time() - start\n      #cat(format(eltime), \"Band\", i, \"- Normalized values computation for scene\", j, \"done\\n\")    \n      #values(scenes.norm[[j,i]]) = log(1+values(scenes.norm[[j,i]]))\n      values(scenes.norm[[j,i]]) = values(scenes.norm[[j,i]]) / max(values(scenes.norm[[j,i]]),na.rm=T)\n      names(scenes.norm[[j,i]]) = paste(\"scene\", j)\n      #scenes.norm[[i]][j] = values(scenes.raw[[j]]) / max(values(scenes.raw[[j]]))\n      eltime = Sys.time() - start\n      cat(format(eltime), \"Band\", bandref[i], \"- Normalized values computation for scene\", j, \"done\\n\")    \n      #eltime = Sys.time() - start\n      #cat(format(eltime), \"Stacking of bands 1 to\", i,\"for scene\", j, \"done\\n\")\n      #names(scenes.norm[[j]]) = 1:i\n      #eltime = Sys.time() - start\n      #cat(format(eltime), \"Renaming of raster stack layers for scene\", j, \"done\\n\")    \n      writeRaster(scenes.norm[[j,i]], paste0(\"./mod/norm_\",tif_files[j]), overwrite=T)\n    }\n  }\n}",
    "created" : 1458757061973.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2925690239",
    "id" : "B6A0EA88",
    "lastKnownWriteTime" : 1418824563,
    "path" : "~/IIS_PROJECTS/Moore/Zonation_AF/rast_norm.R",
    "project_path" : null,
    "properties" : {
    },
    "source_on_save" : false,
    "type" : "r_source"
}