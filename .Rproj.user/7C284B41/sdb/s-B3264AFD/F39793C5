{
    "contents" : "# LNAE: REQUIREMENTS CALCULATOR\n#\n# Created: Jan. 2015\n# Author: Alvaro Iribarrem (IIS-Rio)\n#\n#\n#rm(list=ls())\n\n#source('./sp_plan.R')\n\n\ninf.corr = function(val, inf.vec, val.is.future=F){\n  # Corrects value val from initial to final values of inflation in inf.vec\n  inf.comb = prod(1+inf.vec)\n  res = val * inf.comb\n  if (val.is.future==T){res = val / inf.comb}\n  return(res)\n}\n\n# Read-in farm size data from IBGE (2006)\nfsz.in = read.csv2(\"./AF_farmsize_histogram.csv\", header=F, na.strings=\"-\")\n\nfsz = data.frame(c(0.05,0.15,0.35,0.75,1.5,2.5,3.5,4.5,7.5,15,35,75,\n                   150,350,750,1750,2500))\nnames(fsz) = \"cls\"\nfsz$AF = as.integer(fsz.in[1:17+(0*19),3])\nfsz$AP = as.integer(fsz.in[1:17+(1*19),3])\nfsz$CA = as.integer(fsz.in[1:17+(2*19),3])\nfsz$NB = as.integer(fsz.in[1:17+(3*19),3])\nfsz$PA = as.integer(fsz.in[1:17+(4*19),3])\nfsz$MV = as.integer(fsz.in[1:17+(5*19),3])\nfsz$GT = rowSums(fsz[,2:7], na.rm=T)\n\nfsz.avg = mean(fsz$cls * fsz$GT,na.rm=T)/mean(fsz$GT,na.rm=T)\n\n\n\n# Data frame with information on credit obtained by beef sector per municipality\ndata=data.frame(1999:2012)\nnames(data) = 'ano'\ndata$AF = c(6.0, 4.6, 6.8, 11.2, 8.4, 16.2, 20.3, 18.7, 22.3, 20.0, 28.0, 34.7, 44.8, 60.6)\ndata$AP = c(0.3, 0.4, 0.9, 2.4, 3.2, 4.0, 7.4, 7.4, 10.4, 16.3, 12.9, 8.5, 13.6, 14.2)\ndata$CA = c(0.7, 0.0, 4.2, 5.5, 2.0,   0.8, 0.7, 2.0, 2.4, 2.6, 5.0, 9.6, 9.3, 13.0)\ndata$NB = c(0.0, 0.1, 0.0, 0.5, 2.6, 1.7, 4.0, 8.6, 10.6, 11.9, 12.9, 13.0, 16.6, 14.4)\ndata$PA = c(0.7, 0.8, 1.4, 10.0, 3.4, 5.5, 7.6, 9.1, 14.4, 17.1, 14.5, 22.0, 23.1, 28.8)\ndata$MV = c(1.2, 4.3, 6.9, 4.0, 2.7, 7.0, 2.8, 5.9, 5.9, 7.3, 4.6, 8.7, 11.5, 19.7)\ndata$GT = rowSums(data[,2:7])\n# IPCA Inflation time series (BACEN)\ndata$IPCA = c(8.94,5.97,7.67,12.53,9.3,7.6,5.69,3.14,4.46,5.9,4.31,5.91,6.5,5.84)/100\n\n# Input parameters from Business case\n\n\n\n# Corrects values for inflation to 2010 prices\ndata.cor = data\nfor (i in which(data$ano != 2010)){\n  for (j in 2:8){\n    inf.vec = data$IPCA[i:12]\n    flag = F\n    if (i > 12){\n      inf.vec = data$IPCA[12:i]\n      flag = T\n    }\n    data.cor[i,j] = inf.corr(data[i,j],inf.vec,val.is.future=flag)\n  }\n}\n\n# Fits polynomial to corrected credit time series\nfit=lm(GT~I(ano)+I(ano^2),data.cor[,c(1,8)])\nfit.c = fit$coefficients\n\n# Creates polynomial function with fitted coefficients\nf.fit = function(x){fit.c[[1]] + x*fit.c[[2]] + (x^2)*fit.c[[3]]}\n\nf.fit.pts = f.fit(1999:2030)\n\n\n# Computes tdrive function: rate of intensification deployed on landscape\n\n# Use smoother step function\nsmoother.fun = function(x){6*(x^5)-15*(x^4)+10*(x^3)}\n#tdrive = smoother.fun(1:16/16)\n#plot(1:16/16,tdrive, add=true)\n#plot(1:15/15,diff(tdrive))\n\n# Use projected soy expansion as the main driver of intensification requirements\ntdrive = c(6313.799556, 9288.16041, 13386.84236, 18895.76426, 26110.1929,\n           35304.41242, 46690.4346, 60367.76302, 76269.33679, 94111.5090,\n           113358.4305, 133211.743, 152636.0523, 170425.0103, 185307.847,\n           196086.0584, 201783.231)\ntdrive = tdrive/max(tdrive)\n\n# Plots difference between smoother and fitted tdrive functions\nplot(1:17+2013,tdrive, type=\"l\", xlab='Ano', ylab='Função geratriz')\nlines(1:17+2013,smoother.fun(1:17/17), col=\"red\")\nlegend(\"topleft\", inset=c(0.025,0.025),\n       legend = c(\"Soja ajustada\",\"Função degrau suave\"),\n       col=c(\"black\",\"red\"), lty=c(1,1))\n\n# Computes intensified area per year, and cumulative intensified area\narea.new = sum(A.i.LNAE) * diff(tdrive[-1])\narea.cum = sum(A.i.LNAE) * tdrive[-c(1,2)]\n\n# Creates credit output data frame\ncdt.data = data.frame(1:15+2015)\nnames(cdt.data) = 'ano'\ncdt.data$proj = f.fit(cdt.data$ano)\ncdt.data$LNAE.new = area.new * (area.cost / 1.e6) # area.cost defined in sp_plan.R\ncdt.data$LNAE.mnt = area.cum * (mnt.cost / 1.e6)  # mnt.cost defined in sp_plan.R\ncdt.data$LNAE.GT = cdt.data$LNAE.new + cdt.data$LNAE.mnt\ncdt.data$p.BAU = cdt.data$LNAE.GT / cdt.data$proj\ncdt.data$p.zero = cdt.data$LNAE.GT / (data.cor$GT[length(data.cor$GT)])\n\n# Creates farm-related data frame\nfarm.data = data.frame(1:15+2015)\nnames(farm.data) = 'ano'\nfarm.data$area.GT = area.cum\nfarm.data$cal.new = area.new * area.cal       # area.cal defined in sp_plan.R\nfarm.data$cal.mnt = area.cum * area.cal.yr    # area.cal.yr defined in sp_plan.R\nfarm.data$cal.GT = farm.data$cal.new + farm.data$cal.mnt\nfarm.data$NPK = area.cum * area.NPK.yr        # area.NPK.yr defined in sp_plan.R\nfarm.data$num = cumsum(trunc(5* area.new / fsz.avg)) # farms intensify 20% area\nfarm.data$jnew= ceiling(area.new/fsz.avg/8)   # one TA for 40 impl. farms/yr\nfarm.data$jmnt= ceiling(area.cum/fsz.avg/16)  # one TA for 80 maint. farms/yr\nfarm.data$jobs= farm.data$jnew + farm.data$jmnt\n\n# Creates credit output plot\npng(\"./credit-pt.png\", res=1200, width=9, height=9, unit='cm', pointsize=8)\nplot(data.cor$ano, data.cor$GT, xlab=\"Ano\", ylab=\"Crédito (milhões R$)\",\n     xlim=c(1999,2030), ylim=c(min(data$GT),max(f.fit.pts)))\nlines(data.cor$ano, data.cor$GT)\nlines(1999:2030, f.fit.pts, col='red')\npoints(1:15+2015, cdt.data$LNAE.GT, col='blue', pch=7)\npoints(1:15+2015, cdt.data$LNAE.new, col='blue', pch=22)\npoints(1:15+2015, cdt.data$LNAE.mnt, col='blue', pch=4)\nabline(h=data.cor$GT[length(data.cor$GT)], lty=3)\nlegend(\"topleft\", inset=c(0.025,0.025),\n       legend = c(\"Total histórico\", \"Total projetado\",\n                  \"LNAE: implantação\", \"LNAE: manutenção\", \"LNAE: total\"),\n       col=c(\"black\",\"red\",\"blue\", \"blue\", \"blue\"), lty=c(1,1,0,0,0),\n       pch = c(1, 26, 22, 4, 7))\ndev.off()\n\n# Creates intensified area output plot -- for folder\npng(\"./areaint-pt.png\", res=600, width=9, height=9, unit='cm', pointsize=8)\nplot(cdt.data$ano, area.cum, xlab=\"Ano\",\n      ylab = \"Área intensificada total (ha)\", col='red', type='l')\ndev.off()\n\n# Writes output csv tables\nwrite.csv(cdt.data, \"./credit.csv\", row.names=F)\nwrite.csv(farm.data, \"./farm.csv\", row.names=F)\n",
    "created" : 1458757074186.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2806258663",
    "id" : "F39793C5",
    "lastKnownWriteTime" : 1426372774,
    "path" : "~/IIS_PROJECTS/Moore/Zonation_AF/credit.R",
    "project_path" : null,
    "properties" : {
    },
    "source_on_save" : false,
    "type" : "r_source"
}