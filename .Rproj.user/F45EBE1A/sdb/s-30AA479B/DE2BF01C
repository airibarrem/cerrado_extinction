{
    "contents" : "#rm(list=ls())\nrequire(raster)\nrequire(snowfall)\nsource('./cerrado_fun.R')\n\n# Getting the list of names of all sp.dist files to be included\nsp.dir = './Sp_maps/Flora_Cerrado/'\nsp.files = dir(sp.dir)\n\n# Rasterizing the background shapefile Using first file of sp.dist. as template\nbgd = rasterize(shapefile('./biome/Cerrado.shp'),\n                raster(paste0(sp.dir,sp.files[1])))\n\n# preparing bgd to be used as addition mask (add to a raster to apply the mask)\nbgd = bgd/bgd\nbgd[bgd>0]=0\n\n\n# REDD-PAC land-use shapefile\nLU.shp = shapefile('./LU_REDD_PAC/REED_PAC_BAU.shp')\n\n# Reprojecting LU shapefiles to match background of sp.dist rasters\nLU.shp = spTransform(LU.shp,CRS(proj4string(bgd)))\n\n# Names of classes (columns) in LU.shp\nLU.classes = names(LU.shp)\n\n\n# Native vegetation shapefiles (now = 2010, bau = 2050)\nnat.shp.now = LU.shp[LU.classes %in% c('NatLnd2010','PRIFOR2010','ForReg2010')]\nnat.shp.bau = LU.shp[LU.classes %in% c('NatLnd2050','PRIFOR2050','ForReg2050')]\n\n# Converting native vegetation shapefiles to a combined raster of veg. cover\nnat.shp.now = rasterize(nat.shp.now,bgd)\nnat.shp.bau = rasterize(nat.shp.bau,bgd)\n\n# Each subs command puts in each pixel its corresponding value computed by rasterize\n# Sum over each class in nat.shp corresponding to column in @data@attributes\nnat.now = subs(nat.shp.now,nat.shp.now@data@attributes[[1]][,c(1,2)]) +\n  subs(nat.shp.now,nat.shp.now@data@attributes[[1]][,c(1,3)]) +\n  subs(nat.shp.now,nat.shp.now@data@attributes[[1]][,c(1,4)]) + bgd\nnat.bau = subs(nat.shp.bau,nat.shp.bau@data@attributes[[1]][,c(1,2)]) +\n  subs(nat.shp.bau,nat.shp.bau@data@attributes[[1]][,c(1,3)]) +\n  subs(nat.shp.bau,nat.shp.bau@data@attributes[[1]][,c(1,4)]) + bgd\n\n# Converting area_size (in ha) shapefile to a raster, with area data in all px\nsize.map = rasterize(LU.shp[30],bgd)\nsize.map = subs(size.map, size.map@data@attributes[[1]][,1:2]) + bgd\n\n# Converting pixel size in native vegetation rasters\n# Multiplicative factor 1000 due to unit differences in original shape file\n# now each pixel has a value of veg. area (ha) corresponding to its own area\nnat.now = (nat.now * 1000) * ((area(bgd) * 100) / size.map)\nnat.bau = (nat.bau * 1000) * ((area(bgd) * 100) / size.map)\n\nflora.hab = hab.calc(sp.files, nat.now, nat.bau, binary.px=F,\n                     sp.dir=sp.dir, string.rem='.asc', CSV.name = 'Flora_BRABIOM',\n                     print.CSV=T, sf.on=T, cores=11)\n\n\n# Applying intersect.raster and cond.area to all sp.dist files\n#sfInit(parallel = T, cpus = 7, type = 'SOCK')\n#sfExportAll()\n#sfLibrary(raster)\n# sp. potential area maps today (each pixel contains its area in ha)\n#pot.maps = sfLapply(paste0('./Flora_Cerrado/',sp.files),\n#                    function(x){rcompose(x,bgd)*area(bgd)*100})\n# sp. habitats today\n#hab.maps = sfLapply(paste0('./Flora_Cerrado/',sp.files),\n#                    intersect.raster,nat.now,bgd)\n#sp. habitats under future LUC\n#bau.maps = sfLapply(paste0('./Flora_Cerrado/',sp.files),\n#                    intersect.raster,nat.bau,bgd)\n# List of all the maps for today\n#maps.list = c(pot.maps,hab.maps,bau.maps)\n# List of the areas (in ha) corresponding to the list of maps above\n#pot.areas = sfLapply(pot.maps,function(x){sum(values(x),na.rm=T)})\n#hab.areas = sfLapply(hab.maps,function(x){sum(values(x),na.rm=T)})\n#bau.areas = sfLapply(bau.maps,function(x){sum(values(x),na.rm=T)})\n#sfStop()\n\n# Computing area data.frames\n#now.df = data.frame(Sp=sub(\"_\",' ',sub('.asc','',sp.files)))\n#now.df$Pot_Area = as.numeric(pot.areas)\n#now.df$Hab_Area = as.numeric(hab.areas)\n#now.df$BAU_Area = as.numeric(bau.areas)\n#now.df = now.df[order(now.df$Sp),]\n\n#teste.df = now.df\n#teste.df[,3:4] = now.df[,3:4] / as.numeric(now.df[,2])\n\n\n# Outputting area data.frames\n#write.csv(now.df, file='Flora_BRABIOM')\n#write.csv2(now.df, file='Flora_BRABIOM_2')\n\n#write.csv(teste.df, file='Flora_BRABIOM_perc')\n#write.csv2(teste.df, file='Flora_BRABIOM_perc_2')\n\n# Exporting native vegetation maps\njpeg(\"./BRABIOM_natveg.jpg\", res=600, width=9, height=9, unit='cm', pointsize=8)\nspplot(stack(nat.now,nat.bau), names.attr=c(2010,2050),\n       col.regions=rainbow(18,start=0.1, end=0.3))\ndev.off()\n",
    "created" : 1459303830427.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1582794509",
    "id" : "DE2BF01C",
    "lastKnownWriteTime" : 1459948616,
    "path" : "D:/cerrado_extinction/hab_gilberto.R",
    "project_path" : "hab_gilberto.R",
    "properties" : {
    },
    "relative_order" : 2,
    "source_on_save" : false,
    "type" : "r_source"
}